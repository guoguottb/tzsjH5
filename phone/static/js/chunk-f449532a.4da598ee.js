(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f449532a"],{"5ca9":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app"},[t("header",[e._v("投诉建议")]),t("main",[t("van-form",{on:{submit:e.onSubmit}},[t("van-field",{attrs:{required:"",name:"name",label:"投诉人",placeholder:"请填写投诉人"},model:{value:e.data.name,callback:function(t){e.$set(e.data,"name",t)},expression:"data.name"}}),t("van-field",{attrs:{required:"",name:"tel",label:"手机号码",placeholder:"请填写手机号码",rules:[{required:!0,message:"请填写手机号码"}]},model:{value:e.data.tel,callback:function(t){e.$set(e.data,"tel",t)},expression:"data.tel"}}),t("van-field",{attrs:{name:"complaint_type",label:"投诉类型",placeholder:"点击选择投诉类别","is-link":"",required:"",readonly:"",clickable:"",rules:[{required:!0,message:"点击选择投诉类别"}]},on:{click:function(t){e.showPicker192=!0}},model:{value:e.data.complaint_type,callback:function(t){e.$set(e.data,"complaint_type",t)},expression:"data.complaint_type"}}),t("van-popup",{attrs:{position:"bottom"},model:{value:e.showPicker192,callback:function(t){e.showPicker192=t},expression:"showPicker192"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:e.complaintTypeList},on:{confirm:function(t){return e.ComplaintType(t)},cancel:function(t){e.showPicker192=!1}}})],1),t("van-field",{attrs:{required:"",type:"textarea",name:"complaint_content",rows:"3",autosize:"",label:"投诉内容",placeholder:"请填写投诉内容",rules:[{required:!0,message:"请填写投诉内容"}]},model:{value:e.data.complaint_content,callback:function(t){e.$set(e.data,"complaint_content",t)},expression:"data.complaint_content"}}),t("van-field",{attrs:{name:"uploader",label:"相关材料"},scopedSlots:e._u([{key:"input",fn:function(){return[t("van-uploader",{attrs:{"before-read":e.beforeRead,"after-read":e.uploadImg(3),"before-delete":e.beforeDelete("complaint_picture")},model:{value:e.uploader,callback:function(t){e.uploader=t},expression:"uploader"}})]},proxy:!0}])}),t("div",{staticStyle:{margin:"16px"}},[t("van-button",{attrs:{block:"",type:"info","native-type":"submit"},on:{click:e.save}},[e._v("提交")])],1)],1)],1)])},l=[],i=a("b775"),n=a("fa7d"),s={name:"complaints",data(){return{uploader:[],showPicker192:!1,complaintTypeList:["服务","效率"],data:{name:"",tel:"",complaint_type:"",complaint_content:"",complaint_picture:""}}},methods:{onConfirm(e){this.value=e,this.showPicker=!1},onSubmit(e){console.log("submit",e)},ComplaintType(e){this.data.complaint_type=e,this.showPicker192=!1,console.log(this.data.complaint_type,"192")},save(){this.data.name=this.data.name.replace(/\s*/g,"");let e=Object(n["i"])(this.data.name);if(e)return this.$toast.fail("请输入正确的姓名"),!1;var t=/^[1][3,4,5,7,8,9][0-9]{9}$/;if(!t.test(this.data.tel))return this.$toast.fail("请填写正确的手机号"),!1;console.log(this.data);let a=this.$toast({type:"loading",message:"提交中...",overlay:!0,duration:0});Object(i["a"])({method:"post",url:"/social/assistanceWeixin/saveComplaint",data:{data:"["+JSON.stringify(this.data)+"]"}}).then(e=>{a.clear(),this.$toast.success("提交成功"),this.$dialog.alert({message:"提交成功"}).then(()=>{this.$router.push("/Home2?module=社会群众入口")}),console.log(e)}).catch(e=>{a.clear(),this.$toast.fail("提交失败"),console.log(e)})},beforeRead(e){return console.log(e,"file"),"image/heic"!=e.type&&""!=e.type||(this.$toast.fail("照片格式不正确"),!1)},imgRequest(e,t,a){console.log(222),console.log(e,t,a),Object(i["a"])({method:"post",url:"/social/weixinMinios/fileUpload",data:e}).then(e=>{t.status="done",t.message="上传完成",console.log(e),3==a&&(console.log(1111),this.data.complaint_picture?this.data.complaint_picture=this.data.complaint_picture.concat(",",e[0].filename):this.data.complaint_picture=this.data.complaint_picture.concat(e[0].filename),console.log(this.data.complaint_picture))}).catch(e=>{t.status="failed",t.message="上传失败",3==a&&this.uploader.pop(),this.$toast.fail("上传失败"),console.log(e)})},uploadImg(e){return t=>{console.log(t),console.log(e),t.status="uploading",t.message="上传中...";new n["a"](t,e,this.imgRequest)}},beforeDelete(e){return(t,a)=>{let o=this.data[e].split(",");return o.splice(a.index,1),this.data[e]=o.join(","),console.log(this.data[e]),console.log(e),console.log(t),console.log(a),!0}}}},c=s,r=(a("679f"),a("2877")),p=Object(r["a"])(c,o,l,!1,null,null,null);t["default"]=p.exports},"679f":function(e,t,a){"use strict";a("b4ae")},b4ae:function(e,t,a){}}]);